<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>C++ 基本知识 | MGKL's Note</title><meta name="description" content="曾晓生命脆弱，未料如此不堪">
    <link rel="preload" href="/assets/style-v9YVb9qz.css" as="style"><link rel="stylesheet" href="/assets/style-v9YVb9qz.css">
    <link rel="modulepreload" href="/assets/app-CkPgLnmy.js"><link rel="modulepreload" href="/assets/cpp_interview.html-BuXpS3uc.js">
    <link rel="prefetch" href="/assets/index.html-P0dHuTJc.js" as="script"><link rel="prefetch" href="/assets/data_structure.html-Okyy5Yvo.js" as="script"><link rel="prefetch" href="/assets/cpp_concurrency_programming.html-DeMC_iHZ.js" as="script"><link rel="prefetch" href="/assets/cpp_design_pattern.html-BKRFw7fM.js" as="script"><link rel="prefetch" href="/assets/cpp_lambda_expr.html-C17BiuTa.js" as="script"><link rel="prefetch" href="/assets/read_write_lock.html-BN5NK0lS.js" as="script"><link rel="prefetch" href="/assets/TCP_IP.html-C91nxB5N.js" as="script"><link rel="prefetch" href="/assets/hiredis_usage.html-Dq3AZOo0.js" as="script"><link rel="prefetch" href="/assets/gdb.html-BXkGUCCT.js" as="script"><link rel="prefetch" href="/assets/git.html-6dZjwx_Q.js" as="script"><link rel="prefetch" href="/assets/makefile.html-DsSTmRth.js" as="script"><link rel="prefetch" href="/assets/404.html-wD3O6Kj5.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">MGKL&#39;s Note</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/mgkl92/mgkl92.github.io" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/mgkl92/mgkl92.github.io" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">C++ 基本知识 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="c-基本知识" tabindex="-1"><a class="header-anchor" href="#c-基本知识"><span>C++ 基本知识</span></a></h1><h2 id="_1-值传递-vs-引用传递" tabindex="-1"><a class="header-anchor" href="#_1-值传递-vs-引用传递"><span>1. 值传递 vs. 引用传递</span></a></h2><ul><li><p>值传递和引用传递是两种向函数传递参数的方式。在值传递方式中，形参作为实参的副本，对于形参的修改并不会直接影响到实参但存在拷贝操作；而在引用传递过程中，形参作为实参的引用，其本质上为实参的别名，对于形参的修改将直接作用于实参。</p></li><li><p>值传递在处理较大对象参数时其效率较低。</p></li></ul><div class="language-cpp" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 值传递</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">passByValue</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    value <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 引用传递</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">passByRefer</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    value <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// a = 20 </span></span>
<span class="line"><span class="token function">passByValue</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// a = 100</span></span>
<span class="line"><span class="token function">passByRefer</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><h2 id="_2-左值-vs-右值" tabindex="-1"><a class="header-anchor" href="#_2-左值-vs-右值"><span>2. 左值 vs. 右值</span></a></h2><ul><li>值根据能否出现在复制运算符的左侧分为左值和右值。左值可取地址，通常为变量；右值不可取地址，通常为常量、临时变量等。</li></ul><div class="language-cpp" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// a, b, c 均为左值</span></span>
<span class="line"><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// b + c 为右值</span></span>
<span class="line"><span class="token comment">// &amp;(b + c) 无效</span></span>
<span class="line">a <span class="token operator">=</span> b <span class="token operator">+</span> c<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><h2 id="_3-移动语义-vs-完美转发" tabindex="-1"><a class="header-anchor" href="#_3-移动语义-vs-完美转发"><span>3. 移动语义 vs. 完美转发</span></a></h2><ul><li>移动语义并不对资源进行拷贝，而是对其所有权进行转移，其性能比拷贝更好。</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">size_</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        data_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// copy 构造</span></span>
<span class="line">    <span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">const</span> A<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        size_ <span class="token operator">=</span> a<span class="token punctuation">.</span>size_<span class="token punctuation">;</span></span>
<span class="line">        data_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>size_<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// move 构造</span></span>
<span class="line">    <span class="token function">A</span><span class="token punctuation">(</span>A <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token operator">-&gt;</span>data_ <span class="token operator">=</span> a<span class="token punctuation">.</span>data_<span class="token punctuation">;</span></span>
<span class="line">        a<span class="token punctuation">.</span>data_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token operator">~</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>data_ <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data_<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">int</span> size_<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">int</span> <span class="token operator">*</span> data_<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">A <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// copy</span></span>
<span class="line">A b <span class="token operator">=</span> a<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// move</span></span>
<span class="line">A c <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>完美转发</li></ul><h2 id="_4-列表初始化" tabindex="-1"><a class="header-anchor" href="#_4-列表初始化"><span>4. 列表初始化</span></a></h2><ul><li><p>列表初始化支持对基本数据类型、用户自定义数据类型（类、结构体等）以及容器类型的初始化操作。</p></li><li><p>列表初始化可以避免类型窄化。</p></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 基本数据类型</span></span>
<span class="line"><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 无效：类型窄化</span></span>
<span class="line"><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3.14</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 用户自定义类型</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token operator">:</span> x<span class="token punctuation">{</span>a<span class="token punctuation">}</span><span class="token punctuation">,</span> y<span class="token punctuation">{</span>b<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">Point point<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">struct</span> <span class="token class-name">Aggregate</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">int</span> a<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">double</span> b<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">Aggregate agg <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2.3</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 容器类型</span></span>
<span class="line">vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> vec <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-智能指针" tabindex="-1"><a class="header-anchor" href="#_5-智能指针"><span>5. 智能指针</span></a></h2><ul><li>C++ 采取智能指针进行资源管理以避免内存泄露。</li></ul><h3 id="_5-1-unique-ptr" tabindex="-1"><a class="header-anchor" href="#_5-1-unique-ptr"><span>5.1 unique_ptr</span></a></h3><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Test::Test()&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">~</span><span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Test::~Test()&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Test::test()&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">unique_ptr<span class="token operator">&lt;</span>Test<span class="token operator">&gt;</span> <span class="token function">uptr</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Output: Test::Test()</span></span>
<span class="line"></span>
<span class="line">uptr<span class="token operator">-&gt;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Output: Test::test()</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 当 uptr 离开时作用域时，Test 对象的析构函数会被调用</span></span>
<span class="line"><span class="token comment">// Output: Test::~Test()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-shared-ptr" tabindex="-1"><a class="header-anchor" href="#_5-2-shared-ptr"><span>5.2 shared_ptr</span></a></h3><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">shared_ptr<span class="token operator">&lt;</span>Test<span class="token operator">&gt;</span> <span class="token function">sptr1</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Output: Test::Test()</span></span>
<span class="line"></span>
<span class="line">shared_ptr<span class="token operator">&lt;</span>Test<span class="token operator">&gt;</span> sptr2 <span class="token operator">=</span> sptr1<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// No Output</span></span>
<span class="line"></span>
<span class="line">sptr2<span class="token operator">-&gt;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Output: Test::test()</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 当 sptr1 和 sptr2 离开时作用域时，Test 对象的析构函数会被调用</span></span>
<span class="line"><span class="token comment">// Output: Test::~Test()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-weak-ptr" tabindex="-1"><a class="header-anchor" href="#_5-3-weak-ptr"><span>5.3 weak_ptr</span></a></h3><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">shared_ptr<span class="token operator">&lt;</span>Test<span class="token operator">&gt;</span> <span class="token function">sptr</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Output: Test::Test()</span></span>
<span class="line">weak_ptr<span class="token operator">&lt;</span>Test<span class="token operator">&gt;</span> wptr <span class="token operator">=</span> sptr<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// No Output</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> lockedSharedPtr <span class="token operator">=</span> wptr<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    lockedSharedPtr<span class="token operator">-&gt;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// Output: Test::test()</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 当 sptr 离开时作用域时，Test 对象的析构函数会被调用</span></span>
<span class="line"><span class="token comment">// Output: Test::~Test()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 循环引用</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    shared_ptr<span class="token operator">&lt;</span>B<span class="token operator">&gt;</span> sptr<span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">~</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;A has been destroyed&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    shared_ptr<span class="token operator">&lt;</span>A<span class="token operator">&gt;</span> sptr<span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">~</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;B has been destroyed&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">shared_ptr<span class="token operator">&lt;</span>A<span class="token operator">&gt;</span> a <span class="token operator">=</span> <span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>A<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">shared_ptr<span class="token operator">&lt;</span>B<span class="token operator">&gt;</span> b <span class="token operator">=</span> <span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>B<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">a<span class="token operator">-&gt;</span>sptr <span class="token operator">=</span> b<span class="token punctuation">;</span></span>
<span class="line">b<span class="token operator">-&gt;</span>sptr <span class="token operator">=</span> a<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// No Output !!!</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 即使当 a 和 b 离开作用域时，A 和 B 对象的析构函数因为循环引用将不会被调用。</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="智能指针的不足" tabindex="-1"><a class="header-anchor" href="#智能指针的不足"><span>智能指针的不足</span></a></h3><h2 id="_6-static-关键字" tabindex="-1"><a class="header-anchor" href="#_6-static-关键字"><span>6. static 关键字</span></a></h2><h3 id="_6-1-修饰局部变量" tabindex="-1"><a class="header-anchor" href="#_6-1-修饰局部变量"><span>6.1 修饰局部变量</span></a></h3><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// count 仅在第一次函数调用时初始化</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">++</span>count<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-修饰全局变量或函数" tabindex="-1"><a class="header-anchor" href="#_6-2-修饰全局变量或函数"><span>6.2 修饰全局变量或函数</span></a></h3><p>默认情况下，文件中的全局变量和函数具有外连接性，即能够被其他文件导入使用，但 static 关键字能够禁用这种特性。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// file1.cpp</span></span>
<span class="line"><span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;func() in file1.&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// file2.cpp</span></span>
<span class="line"><span class="token comment">// 无效：编译错误</span></span>
<span class="line"><span class="token keyword">extern</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-修饰成员变量-成员函数" tabindex="-1"><a class="header-anchor" href="#_6-3-修饰成员变量-成员函数"><span>6.3 修饰成员变量 / 成员函数</span></a></h3><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token keyword">int</span> val<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 静态成员初始化</span></span>
<span class="line"><span class="token keyword">int</span> MyClass<span class="token double-colon punctuation">::</span>val <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 调用静态成员函数</span></span>
<span class="line"><span class="token class-name">MyClass</span><span class="token double-colon punctuation">::</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-const-关键字" tabindex="-1"><a class="header-anchor" href="#_7-const-关键字"><span>7. const 关键字</span></a></h2><p>const 关键字修饰的变量除初始化外不可变更其值。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 1. 定义常量</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">int</span> MAX_SIZE <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. 常引用</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token comment">// 3. 修饰类成员函数</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 4. 修饰类成员变量</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-1-define-vs-const" tabindex="-1"><a class="header-anchor" href="#_7-1-define-vs-const"><span>7.1 #define vs. const</span></a></h3><ul><li><p>预处理指令在预处理阶段被展开，即宏展开，其基本机制为文本替换。所以，通过预处理指令定义的常量并不会出现在编译阶段，编译器也不会为之分配存储空间，故不具有类型安全。此外，使用预处理指令可能面临代码膨胀问题。</p></li><li><p>预处理指令不具备作用域，仅在源文件范围内有效，可使用 #undef 取消宏定义。</p></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// #define 宏定义</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PI</span> <span class="token expression"><span class="token number">3.14</span></span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">double</span> area <span class="token operator">=</span> PI <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// const 常量</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">double</span> PI <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">double</span> area <span class="token operator">=</span> PI <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 类型安全</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-const-与指针" tabindex="-1"><a class="header-anchor" href="#_7-2-const-与指针"><span>7.2 const 与指针</span></a></h3><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 1. 指向常量的指针（并非指针为常量）</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">*</span>ptr_ci <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">ptr_ci <span class="token operator">=</span> <span class="token operator">&amp;</span>y<span class="token punctuation">;</span> <span class="token comment">// 有效：修改指针对象的内容</span></span>
<span class="line"><span class="token operator">*</span>ptr_ci <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 无效：修改指针所指对象的内容</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. 指针常量</span></span>
<span class="line"><span class="token keyword">int</span> <span class="token operator">*</span> <span class="token keyword">const</span> cptr_i <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">cptr_i <span class="token operator">=</span> <span class="token operator">&amp;</span>y<span class="token punctuation">;</span> <span class="token comment">// 无效：修改指针对象的内容</span></span>
<span class="line"><span class="token operator">*</span>cptr_i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 有效：修改指针所指对象的内容</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3. 指向常量的常量指针</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">*</span> <span class="token keyword">const</span> cptr_ci <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">cptr_ci <span class="token operator">=</span> <span class="token operator">&amp;</span>y<span class="token punctuation">;</span> <span class="token comment">// 无效：修改指针对象的内容</span></span>
<span class="line"><span class="token operator">*</span>cptr_ci <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 无效：修改指针所指对象的内容</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-inline-关键字" tabindex="-1"><a class="header-anchor" href="#_8-inline-关键字"><span>8. inline 关键字</span></a></h2><ul><li><p>函数的内联化指的是编译器将对函数的调用替换为其函数体，能够减少函数调用的开销。内联函数一般体积较小且在程序执行期间被频繁调用。</p></li><li><p><code>inline</code> 关键字一般只是作为编译器的优化建议，这并不代表函数一定会在编译期间展开。</p></li><li><p>函数内联展开的行为类似预处理指令的定义，但函数的内联化为编译阶段行为且具有类型安全性。</p></li></ul><h2 id="_9-数组与指针" tabindex="-1"><a class="header-anchor" href="#_9-数组与指针"><span>9. 数组与指针</span></a></h2><ul><li><p>编译器在栈上为数组的所有元素分配连续的存储空间，数组的大小在便阶段确定，在运行阶段保持不变。而指针本质上仍为变量，其内容为内存地址，可通过动态内存分配存储空间。</p></li><li><p>数组和指针均具有类型安全性。数组元素类型在编译阶段完成绑定，而指针指向内容的类型可重新分配（前提是具有兼容性）。</p></li><li><p>数组名在本质上为指向数组首元素的指针常量，不能够对其进行 <code>++</code> 和 <code>--</code> 操作，但允许指针间的算术操作（指针加上一个偏移，两个指针作差等）。</p></li><li><p>对数组名使用 sizeof 返回的是数组元素占用的字节数目，而对指针使用 sizeof 返回的是指针变量占用字节数（由地址的位数决定）。</p></li><li></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 在表达式中，数组名会被自动转化为指向数组首元素的地址。</span></span>
<span class="line"><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// arr -&gt; &amp;arr[0]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-explicit-关键字" tabindex="-1"><a class="header-anchor" href="#_10-explicit-关键字"><span>10. explicit 关键字</span></a></h2><p><code>explicit</code> 关键字用于防止构造函数或转换函数在不合适的情况下被隐式调用。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 避免单参构造函数隐式转换</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">explicit</span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">value</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">int</span> value<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 无效：隐式转换</span></span>
<span class="line">Bar bar <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 避免隐式转换操作隐式</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Double</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">explicit</span> <span class="token keyword">operator</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">double</span> value<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">Double d<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 无效：隐式转换</span></span>
<span class="line"><span class="token keyword">int</span> i <span class="token operator">=</span> d<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 有效</span></span>
<span class="line"><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 避免复杂构造函数中的隐式转换</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">explicit</span> <span class="token function">Widget</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">bool</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">value</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">flag</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">int</span> value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">bool</span> flag<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-final-关键字" tabindex="-1"><a class="header-anchor" href="#_11-final-关键字"><span>11. final 关键字</span></a></h2><p><code>final</code> 关键字用于防止类被继承或虚函数被覆盖。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 防止类被继承</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token keyword">final</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 无效：Base 类无法被继承</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Base</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 防止虚函数被覆盖</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">final</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Base</span></span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token comment">// 无效： func() 无法被覆盖</span></span>
<span class="line">    <span class="token comment">// override 关键字用于指出该方法为覆盖基类中某个虚函数的定义</span></span>
<span class="line">    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_12-内存对齐" tabindex="-1"><a class="header-anchor" href="#_12-内存对齐"><span>12. 内存对齐</span></a></h2><h2 id="_13-类型转换" tabindex="-1"><a class="header-anchor" href="#_13-类型转换"><span>13. 类型转换</span></a></h2><p><strong><code>static_cast</code></strong> 用于有明确类型之间的转换，如基本数据类型。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">float</span> b <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 仅在编译阶段进行类型检查</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>dynamic_cast</code></strong> 主要用于多态类型的指针或引用之间的转换。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">Base <span class="token operator">*</span>base_ptr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">Derived <span class="token operator">*</span>derived_ptr <span class="token operator">=</span> <span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Derived <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>base_ptr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 仅当类包含虚函数时使用</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>const_cast</code></strong> 用于添加或移除常量修饰。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">const</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token operator">*</span>b <span class="token operator">=</span> <span class="token generic-function"><span class="token function">const_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 仅影响底层 const 属性？</span></span>
<span class="line"><span class="token operator">*</span>b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 修改原本为 const 的值</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>reinterpret_cast</code></strong></p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">long</span> p <span class="token operator">=</span> <span class="token number">0x12345678</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">int</span> <span class="token operator">*</span>i <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reinterpre_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 无类型安全性检查</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_14-volatile-关键字" tabindex="-1"><a class="header-anchor" href="#_14-volatile-关键字"><span>14. volatile 关键字</span></a></h2><h2 id="_15-多态" tabindex="-1"><a class="header-anchor" href="#_15-多态"><span>15. 多态</span></a></h2><ul><li>静态多态：在程序编译时完成绑定</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">char</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">add</span><span class="token punctuation">(</span><span class="token char">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>动态多态：在程序运行时完成绑定</p><p><strong>条件</strong></p><ul><li><p>虚函数</p></li><li><p>通过基类引用/指针调用虚函数</p></li></ul></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">virtual</span> Base<span class="token operator">*</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;victory&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Base</span></span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">virtual</span> Derived<span class="token operator">*</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;yeah&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">Derived d<span class="token punctuation">;</span></span>
<span class="line">Base  <span class="token operator">*</span>b <span class="token operator">=</span> <span class="token operator">&amp;</span>d<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Derived::test()</span></span>
<span class="line">b<span class="token operator">-&gt;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_16-虚函数" tabindex="-1"><a class="header-anchor" href="#_16-虚函数"><span>16. 虚函数</span></a></h2><p>虚函数是 C++ 实现多态的关键机制。</p><p>虚函数允许你在基类中使用 <code>virtual</code> 关键字修饰函数，然后在其派生类里对该虚函数重新定义。C++ 可以根据对象的实际类型（而非引用或指针的静态类型）调用派生类的函数实现。</p><p>虚函数实现依赖于虚函数表（vtable）和虚函数表指针（vptr）。每个含有虚函数的类都有一张虚函数表，该表中存储类中虚函数的地址。每个对象都有一个虚函数表指针，该指针指向这个类的虚函数表。在函数调用时，程序会通过对象的虚函数表指针找到相应虚函数的地址，然后进行函数调用。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Base</span></span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">Base <span class="token operator">*</span>base_ptr<span class="token punctuation">;</span></span>
<span class="line">Derived derived<span class="token punctuation">;</span></span>
<span class="line">base_ptr <span class="token operator">=</span> <span class="token operator">&amp;</span>derived<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">base_ptr<span class="token operator">-&gt;</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用 Derived 类的 func() 函数</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 包含纯虚函数的类不能够被实例化，只能被继承！</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">AbstractBase</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注：因为，在对象初始化阶段虚函数表对象仍未被建立并初始化；所以，构造函数不能够被 <code>virtual</code> 关键字修饰。</p><p>注：析构函数可以被 <code>virtual</code> 关键字修饰，这样可以保证派生类对象能够被正确释放，从而避免资源泄露。</p><p>注：由于静态成员函数与类而非某个具体对象关联，而友元函数其本质上并非类的成员函数；因此，静态成员函数和友元函数也不能够被 <code>virtual</code> 关键字修饰。</p><p><strong>纯虚函数</strong> 在 vtable 中被赋值为 0，表示指向一个不存在的函数。</p><p><strong>菱形继承问题</strong></p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 非虚继承</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span></span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">A</span></span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// D 类对象中包含继承自 B 的 A 类对象和继承自 C 的 A 类对象且这两个子类对象相互独立</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token class-name">C</span></span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> </span>
<span class="line"></span>
<span class="line"><span class="token comment">// 虚继承</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">virtual</span> <span class="token keyword">public</span> <span class="token class-name">A</span></span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">virtual</span> <span class="token keyword">public</span> <span class="token class-name">A</span></span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 虚继承使得 D 类对象中仅包含一个 A 类对象</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token class-name">C</span></span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>虚继承确保在派生类中，仅包含一个基类实例，从而能够避免访问基类成员时的歧义问题。但虚继承会影响类的内存布局，因为编译器需要增加额外的指针或控制块来管理菱形结构中基类的单一实例。</p><h2 id="_17-struct-vs-class" tabindex="-1"><a class="header-anchor" href="#_17-struct-vs-class"><span>17. struct vs. class</span></a></h2><p>!C++ 对 C 中的 <code>struct</code> 进行了扩充，使其能像 <code>class</code> 一样进行工作。</p><p>在 C++ 中， 使用 <code>struct</code> 和 <code>class</code> 关键字均可以定义类，区别在于类中成员的默认访问级别：前者为 <code>public</code>，而后者为 <code>private</code>。此外，在继承关系中也遵循上述规则。</p><p>在类模板的参数定义中，可以使用 <code>class</code> 替换 <code>typename</code>, 但不能使用 <code>struct</code> 进行替换。</p><h2 id="_18-struct-vs-union" tabindex="-1"><a class="header-anchor" href="#_18-struct-vs-union"><span>18. struct vs. union</span></a></h2><p>在 struct 中，所有的成员变量占据独立的内存空间；而 union 的所有成员变量共享一块内存空间且该空间大小由最大数据成员所需存储空间决定。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">struct</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">int</span> x<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">int</span> y<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// struct 所有成员变量可以同时存在并被访问</span></span>
<span class="line">Point p<span class="token punctuation">;</span></span>
<span class="line">p<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line">p<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">union</span> Single <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">int</span> a<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">int</span> b<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// union 有且仅有一个成员变量存在且被访问</span></span>
<span class="line"><span class="token comment">// 如果在一个成员值发生改变后访问另外一个成员，结果不可预知！</span></span>
<span class="line">Single s<span class="token punctuation">;</span></span>
<span class="line">s<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line">s<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_19-using-vs-typedef" tabindex="-1"><a class="header-anchor" href="#_19-using-vs-typedef"><span>19. using vs. typedef</span></a></h2><p><code>using</code> 和 <code>typedef</code> 均可以为已有类型定义别名，区别在于：<code>using</code> 可以为模板定义别名，而 <code>typedef</code> 不可以。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 使用 typedef 定义类型别名</span></span>
<span class="line"><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> ulong<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">typedef</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>func_ptr<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用 using 定义类型别名</span></span>
<span class="line"><span class="token keyword">using</span> ulong <span class="token operator">=</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">using</span> func_ptr <span class="token operator">=</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用 using 定义模板别名</span></span>
<span class="line"><span class="token keyword">template</span> <span class="token operator">&lt;</span>T<span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">using</span> Vector <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">Vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> vec<span class="token punctuation">;</span> <span class="token comment">// 等价于 std::vector&lt;int&gt; vec;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用 using 命名空间引入</span></span>
<span class="line"><span class="token keyword">namespace</span> LongNamespace <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">int</span> value<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> LN <span class="token operator">=</span> LongNamespace<span class="token punctuation">;</span></span>
<span class="line">LN<span class="token double-colon punctuation">::</span>value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span> <span class="token comment">// 等价于 LongNamespace::value = 42;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_20-enum-vs-enum-class" tabindex="-1"><a class="header-anchor" href="#_20-enum-vs-enum-class"><span>20. enum vs. enum class</span></a></h2><p>在 C++ 中，<code>enum</code> 和 <code>enum class</code> 主要区别在于作用域和类型安全。</p><p><strong>作用域</strong></p><ul><li><p><code>enum</code> 的枚举成员直接进入其包含作用域，即可以直接使用其枚举成员，无需前缀。</p></li><li><p><code>enum class</code> 的枚举成员只能通过显式的指定其枚举类型访问，即使用枚举名作为前缀。</p></li></ul><p><strong>类型安全</strong></p><ul><li><p><code>enum</code> 的枚举成员会被隐式转化为整数。</p></li><li><p><code>enum class</code> 是强类型枚举，不能隐式的转化为其他类型，必须显式转换。</p></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">enum</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span></span>
<span class="line">    RED<span class="token punctuation">,</span></span>
<span class="line">    GREEN<span class="token punctuation">,</span></span>
<span class="line">    BLUE</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">Color color <span class="token operator">=</span> RED<span class="token punctuation">;</span> <span class="token comment">// 无前缀直接访问</span></span>
<span class="line"><span class="token keyword">int</span> color_code <span class="token operator">=</span> RED<span class="token punctuation">;</span> <span class="token comment">// 隐式转化</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span></span>
<span class="line">    RED<span class="token punctuation">,</span></span>
<span class="line">    GREEN<span class="token punctuation">,</span></span>
<span class="line">    BLUE</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line">Color color <span class="token operator">=</span> Color<span class="token double-colon punctuation">::</span>RED<span class="token punctuation">;</span> <span class="token comment">// 前缀访问呢</span></span>
<span class="line"><span class="token keyword">int</span> color_code <span class="token operator">=</span> Color<span class="token double-colon punctuation">::</span>RED<span class="token punctuation">;</span> <span class="token comment">// 无效：不支持隐式转换</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_21-new-delete-vs-malloc-free" tabindex="-1"><a class="header-anchor" href="#_21-new-delete-vs-malloc-free"><span>21. new &amp;&amp; delete vs. malloc &amp;&amp; free</span></a></h2><ul><li><p>new 和 delete 是操作符，而 malloc 和 free 为函数；</p></li><li><p>使用 new 创建对象时，无需指定对象的大小，new 先为对象分配内存空间，然后调用对象的构造函数；</p></li><li><p>malloc 需要指定申请内存空间的大小，返回 void 类型指针，需要使用强制类型转换将 void 指针转化为目标对象的指针；</p></li><li><p>new 关键字具有类型安全性；</p></li><li><p>new 分配失败时将抛出异常，而 malloc 则返回 NULL。</p></li></ul><h2 id="_22-delete-关键字和-default-关键字" tabindex="-1"><a class="header-anchor" href="#_22-delete-关键字和-default-关键字"><span>22. delete 关键字和 default 关键字</span></a></h2><ul><li><p><code>delete</code> 关键字用来禁用某些默认的成员函数。</p></li><li><p><code>default</code> 关键字用于显式地指示编译为某个成员函数生成默认实现。</p></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">NonCopyable</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token function">NonCopyable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">NonCopyable</span><span class="token punctuation">(</span><span class="token keyword">const</span> NonCopyable <span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line">    NonCopyable <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> NonCopyable<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span>；</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_23-this-指针" tabindex="-1"><a class="header-anchor" href="#_23-this-指针"><span>23. this 指针</span></a></h2><p><code>this</code> 指针是隐含在每一个非静态成员函数中的指针，它用来指向调用该成员函数的对象。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 1. 访问类非静态成员变量和成员函数</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Box</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token function">Box</span><span class="token punctuation">(</span><span class="token keyword">double</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token operator">-&gt;</span>length <span class="token operator">=</span> length<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">private</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">double</span> lenght<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. 链式调用</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Box</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    Box <span class="token operator">&amp;</span> <span class="token function">set_length</span><span class="token punctuation">(</span><span class="token keyword">double</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token operator">-&gt;</span>length <span class="token operator">=</span> length<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;The length is &quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">Box box<span class="token punctuation">;</span></span>
<span class="line">box<span class="token punctuation">.</span><span class="token function">set_length</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3. 动态绑定</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">pubic</span> <span class="token class-name">Base</span></span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">Derived derived<span class="token punctuation">;</span></span>
<span class="line">Base <span class="token operator">*</span>base_ptr <span class="token operator">=</span> <span class="token operator">&amp;</span>derived<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Derived 对象的 show 成员函数将被调用</span></span>
<span class="line">base_ptr<span class="token operator">-&gt;</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_24-auto-decltype" tabindex="-1"><a class="header-anchor" href="#_24-auto-decltype"><span>24. auto &amp; decltype</span></a></h2><p><code>auto</code> 和 <code>decltype</code> 关键字自 C++ 11 引入，其作用为类型推断。</p><p><code>auto</code> 用于自动推断变量的类型。编译器将根据变量的初始化表示来推导变量的类型。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">auto</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// x -&gt; int</span></span>
<span class="line"><span class="token keyword">auto</span> y <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span> <span class="token comment">// y -&gt; double</span></span>
<span class="line"><span class="token keyword">auto</span> s <span class="token operator">=</span> <span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">;</span> <span class="token comment">// s -&gt; string</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>decltype</code> 用于推断表达式的类型，它将返回一个表达式对应的类型信息，该过程并不会正在的计算相应表达式！</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">decltype</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// y -&gt; int</span></span>
<span class="line"><span class="token keyword">decltype</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token number">10.0</span><span class="token punctuation">)</span> z <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> <span class="token comment">// z -&gt; double</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// example 1</span></span>
<span class="line">vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> string<span class="token operator">&gt;&gt;</span> vec<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> string<span class="token operator">&gt;&gt;</span><span class="token double-colon punctuation">::</span>iterator it <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> v<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用 auto 进行类型的自动推导 </span></span>
<span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> v<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// example 2</span></span>
<span class="line"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">U</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">auto</span> <span class="token function">add</span><span class="token punctuation">(</span>T a<span class="token punctuation">,</span> U b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">decltype</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_24-堆内存-vs-栈内存" tabindex="-1"><a class="header-anchor" href="#_24-堆内存-vs-栈内存"><span>24. 堆内存 vs. 栈内存</span></a></h2><ul><li><p>分配方式：栈内存由编译器在程序运行时自动分配和释放；而堆内存需要程序手动分配和释放。</p></li><li><p>管理方式：栈内存由编译自动管理，生命周期由其作用域决定；而对内存由程序员手动进行管理，如果内存没有被正确释放将导致内存泄露。</p></li><li><p>生命周期：变量在离开作用域后自动销毁；而堆内存需要手动释放，否则将持续存在至程序结束。</p></li><li><p>性能：堆内存分配和释放速度快；而堆内存涉及到复杂内存管理和分配机制，性能较慢。</p></li></ul><p>栈空间有限，如果递归过深或者分配局部变量太大，将导致栈空间溢出（所需空间大于栈内存空间）。</p><p>堆内存如果没有被正确释放，将导致内存泄露，从而影响系统的整体性能。</p><h2 id="_25-nullptr-vs-null" tabindex="-1"><a class="header-anchor" href="#_25-nullptr-vs-null"><span>25. nullptr vs. NULL</span></a></h2><p><code>nullptr</code> 有明确的类型，其类型为 <code>std::nullptr_t</code>，可以避免代码中出现类型不一致的问题，具有类型安全性。</p><p><code>NULL</code> 通常被定义为数组 <code>0</code>，其实际上为整型值，这可能引发类型不一致问题，如在参数传递时，编译器无法判断是整数 <code>0</code> 还是空指针！</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 代码可读性差</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// example 1</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span> ptr<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 调用？</span></span>
<span class="line"><span class="token function">func</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 调用 func(void *ptr)</span></span>
<span class="line"><span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// example 2</span></span>
<span class="line"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span>T x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// int</span></span>
<span class="line"><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// ？</span></span>
<span class="line"><span class="token function">foo</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// std::nullptr_t</span></span>
<span class="line"><span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_26-include-a-h-和-include-a-h" tabindex="-1"><a class="header-anchor" href="#_26-include-a-h-和-include-a-h"><span>26. #include &quot;a.h&quot; 和 #include &lt;a.h&gt;</span></a></h2><p>使用 &lt;&gt;， 编译器会在预定义的系统安装目录中搜索头文件，主要用于标准库和第三方库的头文件。 使用 &quot;&quot;， 编译器会先在当前源文件所在目录和自定义目录中搜索头文件；然后，再在系统预定义的安装目录中进行搜索。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 预定义的系统安装目录</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 当前目录 / 预定义的系统安装目录</span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;a.h&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_27-浅拷贝-vs-浅拷贝" tabindex="-1"><a class="header-anchor" href="#_27-浅拷贝-vs-浅拷贝"><span>27. 浅拷贝 vs. 浅拷贝</span></a></h2><p>浅拷贝与深拷贝的区别在于深拷贝会拷贝对象所持有的内存或资源，深拷贝对象与被拷贝对象之间对内存或资源的操作相互独立。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>strlen<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>strcpy<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">private</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> input<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">strcpy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 深拷贝</span></span>
<span class="line">    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass <span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span> <span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token function">strcpy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> other<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 赋值拷贝</span></span>
<span class="line">    MyClass <span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass <span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>other<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// self-assignment</span></span>
<span class="line">            <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">;</span> <span class="token comment">// 先释放资源，再拷贝资源</span></span>
<span class="line">            data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token function">strcpy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> other<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token operator">~</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">MyClass <span class="token function">obj</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">MyClass copied_obj <span class="token operator">=</span> obj<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_28-命名空间-namespace" tabindex="-1"><a class="header-anchor" href="#_28-命名空间-namespace"><span>28. 命名空间 <code>namespace</code></span></a></h2><p>命名空间主要用于解决名称冲突的问题。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">namespace</span> mgkl <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">int</span> x<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">// 访问</span></span>
<span class="line">mgkl<span class="token double-colon punctuation">::</span>x<span class="token punctuation">;</span></span>
<span class="line">mgkl<span class="token double-colon punctuation">::</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 嵌套命名空间</span></span>
<span class="line"><span class="token keyword">namespace</span> Outer <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">namespace</span> Inner <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">int</span> x<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">// 访问</span></span>
<span class="line">Outer<span class="token double-colon punctuation">::</span>Inter<span class="token double-colon punctuation">::</span>x<span class="token punctuation">;</span></span>
<span class="line">Outer<span class="token double-colon punctuation">::</span><span class="token class-name">Inter</span><span class="token double-colon punctuation">::</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 匿名命名空间</span></span>
<span class="line"><span class="token comment">// 不能够在文件外访问，即禁用外连接特性</span></span>
<span class="line"><span class="token keyword">namespace</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">int</span> x<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_29-引用和指针" tabindex="-1"><a class="header-anchor" href="#_29-引用和指针"><span>29. 引用和指针</span></a></h2><p>指针是一个变量，存储的是地址。</p><p>引用与原来变量实质上是同一个变量，引用为原先变量的别名，引用本身并不存储指针，而是在底层通过指针来实现对原先变量的访问。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token operator">&amp;</span>ra <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// 有效</span></span>
<span class="line"><span class="token keyword">int</span> <span class="token operator">&amp;</span>rb<span class="token punctuation">;</span> <span class="token comment">// 无效：引用必须被初始化</span></span>
<span class="line">ra <span class="token operator">=</span> b<span class="token punctuation">;</span> <span class="token comment">// 无效：引用一旦被创建不能够重新赋值</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">int</span> <span class="token operator">*</span>pa <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span> <span class="token comment">// 有效</span></span>
<span class="line"><span class="token keyword">int</span> <span class="token operator">*</span>pb<span class="token punctuation">;</span> <span class="token comment">// 有效</span></span>
<span class="line">pb <span class="token operator">=</span> <span class="token operator">&amp;</span>b<span class="token punctuation">;</span> <span class="token comment">// 有效</span></span>
<span class="line">pb <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span> <span class="token comment">// 有效</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="进阶" tabindex="-1"><a class="header-anchor" href="#进阶"><span>进阶</span></a></h1><h2 id="_30-程序的生命周期" tabindex="-1"><a class="header-anchor" href="#_30-程序的生命周期"><span>30. 程序的生命周期</span></a></h2><ol><li><p>编写代码</p></li><li><p>预处理</p></li></ol><ul><li><p>头文件 <code>#include</code></p></li><li><p>宏定义 <code>#define</code></p></li><li><p>条件编译 <code>#ifdef</code>, <code>#ifndef</code> ...</p></li></ul><ol start="3"><li>编译</li></ol><ul><li><p>词法分析</p></li><li><p>语法分析</p></li><li><p>语义分析</p></li></ul><ol start="4"><li><p>汇编</p></li><li><p>链接</p></li></ol><ul><li><p>符号解析</p></li><li><p>地址分配</p></li><li><p>重定义</p></li></ul><h2 id="_31-new-delte-new-delete-成对使用" tabindex="-1"><a class="header-anchor" href="#_31-new-delte-new-delete-成对使用"><span>31. new &amp; delte, new [] &amp; delete[] 成对使用</span></a></h2><p>当使用 <code>new[]</code> 分配连续的内存时，编译器不仅管理数据的实际存储位置，还存储了数组的大小信息，使得 <code>delete[]</code> 能够正确释放内存。</p><ul><li><p>使用 <code>new[]</code> 分配内存空间但是用 <code>delete</code> 释放，数组中的每个对象的析构函数不会被调用（除数组地址指向的首个数据元素），导致内存泄露。</p></li><li><p>使用 <code>new</code> 分配内存空间但是使用 <code>delete[]</code> 释放，可能导致未定义行为（这取决于存储数组大小信息存储空间的内容以及程序的运行状态）！</p></li></ul><p>注：在面对基本数据类型时，可以不成对使用，即使这样也不会造成内存泄露（基本数据类型不含析构函数）。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">inner</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;inner()&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">~</span><span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;~inner()&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">inner <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token keyword">new</span> inner<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">delete</span> p<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/** Output:</span>
<span class="line">* inner()</span>
<span class="line">* inner()</span>
<span class="line">* ~inner()</span>
<span class="line">*/</span></span>
<span class="line"></span>
<span class="line">inner <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> p<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/** Output:</span>
<span class="line">* inner()</span>
<span class="line">* ~inner()</span>
<span class="line">* ~inner()</span>
<span class="line">* ...</span>
<span class="line">* Aborted (core dumped)</span>
<span class="line">*/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_32-unique-ptr-实现原理" tabindex="-1"><a class="header-anchor" href="#_32-unique-ptr-实现原理"><span>32. unique_ptr 实现原理</span></a></h2><p>智能指针 <code>unique_ptr</code> 由 C++ 11 引入，遵循 RAII 规则，自动管理资源的动态分配与释放。</p><p>由 <code>unique_ptr</code> 管理的资源具有独占特性，一旦被分配，不允许复制，仅能使用 <code>std::move</code> 进行所有权的转移。这种独占性源自在 C++ 实现中禁用了拷贝构造和赋值运算符。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token function">unique_ptr</span><span class="token punctuation">(</span><span class="token keyword">const</span> unique_ptr <span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">unique_ptr <span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> unique_ptr<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Up</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Up_Deleter</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token function">unique_ptr</span><span class="token punctuation">(</span><span class="token keyword">const</span> unique_ptr<span class="token operator">&lt;</span>_Up<span class="token punctuation">,</span> _Up_Deleter<span class="token operator">&gt;</span> <span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Up</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Up_Deleter</span><span class="token operator">&gt;</span></span>
<span class="line">unique_ptr <span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> unique_ptr<span class="token operator">&lt;</span>_Up<span class="token punctuation">,</span> _Up_Deleter<span class="token operator">&gt;</span> <span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 创建 unique_ptr</span></span>
<span class="line">unique_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">ptr1</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">auto</span> ptr2 <span class="token operator">=</span> <span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 转移所有权</span></span>
<span class="line">unique_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> ptr3 <span class="token operator">=</span> <span class="token function">move</span><span class="token punctuation">(</span>ptr1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_33-shared-ptr-实现原理" tabindex="-1"><a class="header-anchor" href="#_33-shared-ptr-实现原理"><span>33. shared_ptr 实现原理</span></a></h2><ul><li><p>智能指针 <code>shared_ptr</code> 使用引用计数来记录指向当前资源引用数目。</p></li><li><p>当构建新的对象时，引用计数初始化为 1；当拷贝对象时，引用技术加 1；当对象作用域结束析构时，引用计数减 1；当引用计数减少为 0 时，资源被释放。</p></li><li><p>share_ptr 具有线程安全性，即保证多个线程能够安全的增加或减少引用计数，但并不保证其所持资源的线程安全性。</p></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 手动实现</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">SharedCount</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token function">SharedCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> count_<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">++</span>count_<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">--</span>count_<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> count_<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span><span class="token operator">:</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> count_<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">SharedPtr</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token function">SharedPtr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> ptr_<span class="token punctuation">{</span><span class="token keyword">nullptr</span><span class="token punctuation">}</span><span class="token punctuation">,</span> ref_count_<span class="token punctuation">{</span><span class="token keyword">new</span> SharedCount<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">SharedPtr</span><span class="token punctuation">(</span>T<span class="token operator">*</span> ptr<span class="token punctuation">)</span> <span class="token operator">:</span> ptr_<span class="token punctuation">{</span>ptr<span class="token punctuation">}</span><span class="token punctuation">,</span> ref_count_<span class="token punctuation">{</span><span class="token keyword">new</span> SharedCount<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">SharedPtr</span><span class="token punctuation">(</span><span class="token keyword">const</span> SharedPtr<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token operator">-&gt;</span>ptr_ <span class="token operator">=</span> other<span class="token punctuation">.</span>ptr_<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token operator">-&gt;</span>ref_count_ <span class="token operator">=</span> other<span class="token punctuation">.</span>ref_count_<span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 增加引用计数</span></span>
<span class="line">        ref_count_<span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    SharedPtr <span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> SharedPtr <span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>other <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token operator">-&gt;</span>ptr_ <span class="token operator">=</span> other<span class="token punctuation">.</span>ptr_<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token operator">-&gt;</span>ref_count_ <span class="token operator">=</span> other<span class="token punctuation">.</span>ref_count_<span class="token punctuation">;</span></span>
<span class="line">            ref_count_<span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 移动语义</span></span>
<span class="line">    <span class="token function">SharedPtr</span><span class="token punctuation">(</span>SharedPtr <span class="token operator">&amp;&amp;</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token operator">-&gt;</span>ptr_ <span class="token operator">=</span> other<span class="token punctuation">.</span>ptr_<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token operator">-&gt;</span>ref_count_ <span class="token operator">=</span> other<span class="token punctuation">.</span>ref_count_<span class="token punctuation">;</span></span>
<span class="line">        other<span class="token punctuation">.</span>ptr_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span> </span>
<span class="line">        other<span class="token punctuation">.</span>ref_count_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    SharedPtr <span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>SharedPtr <span class="token operator">&amp;&amp;</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>other <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">this</span><span class="token operator">-&gt;</span>ptr_ <span class="token operator">=</span> other<span class="token punctuation">.</span>ptr_<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token operator">-&gt;</span>ref_count_ <span class="token operator">=</span> other<span class="token punctuation">.</span>ref_count_<span class="token punctuation">;</span></span>
<span class="line">            other<span class="token punctuation">.</span>ptr_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span> </span>
<span class="line">            other<span class="token punctuation">.</span>ref_count_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token operator">~</span><span class="token function">SharedPtr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span><span class="token operator">:</span></span>
<span class="line">    T<span class="token operator">*</span> ptr_<span class="token punctuation">;</span></span>
<span class="line">    SharedCount <span class="token operator">*</span> ref_count_<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>ref_count_<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 减少引用计数</span></span>
<span class="line">            ref_count_<span class="token operator">-&gt;</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 释放资源</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>ref_count_<span class="token operator">-</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>ptr_<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">delete</span> ptr_<span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token keyword">delete</span> ref_count_<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_34-weak-ptr-实现原理" tabindex="-1"><a class="header-anchor" href="#_34-weak-ptr-实现原理"><span>34. weak_ptr 实现原理</span></a></h2><p>智能指针 <code>weak_ptr</code> 主要用来解决 <code>shared_ptr</code> 中存在的循环引用问题。</p><p><code>weak_ptr</code> 基于 <code>shared_ptr</code> 实现，本身并不管理资源，而是与 <code>shared_ptr</code> 共享内部的控制块，该控制块包含指向实际资源的指针和引用计数。 当所有的 <code>shared_ptr</code> 对象被销毁时，资源被释放；但控制块将直到所有的 <code>weak_ptr</code> 对象销毁才释放。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 成员函数</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 将 weak_ptr 转换为 shared_ptr</span></span>
<span class="line"><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </span>
<span class="line"></span>
<span class="line"><span class="token comment">// 检查 weak_ptr 指向资源是否已经被释放</span></span>
<span class="line"><span class="token function">expired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_35-make-shared" tabindex="-1"><a class="header-anchor" href="#_35-make-shared"><span>35. make_shared</span></a></h2><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 方式 1 </span></span>
<span class="line"><span class="token keyword">auto</span> s_ptr <span class="token operator">=</span> <span class="token generic-function"><span class="token function">shared_ptr</span><span class="token generic class-name"><span class="token operator">&lt;</span>A<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 方式 2 (推荐)</span></span>
<span class="line"><span class="token keyword">auto</span> s_ptr <span class="token operator">=</span> <span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>A<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>；</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>方式 1 可能存在两次动态内存的分配，即资源所需内存以及 <code>shared_ptr</code> 智能指针所需内存（控制块）的分配；而方式 2 可一次性完成上述两个工作。</p><h2 id="_36-shared-from-this" tabindex="-1"><a class="header-anchor" href="#_36-shared-from-this"><span>36. shared_from_this</span></a></h2><h2 id="_37-静态库-vs-动态库" tabindex="-1"><a class="header-anchor" href="#_37-静态库-vs-动态库"><span>37. 静态库 vs. 动态库</span></a></h2><ul><li><p>动态库在运行时被加载，提供共享地库文件（如 .dll, .so）；而静态库（如 .lib, .a）在编译时将被直接合并到可执行文件中。</p></li><li><p>动态库在内存中被多个程序共享，可以节省内存空间和磁盘空间，但会引入加载开销；而对于静态库，每个使用它的程序都会有一份拷贝，二进制文件较大，但启动速度较快。</p></li><li><p>动态库在升级时，无需重新编译依赖于该库的程序，只需更新库文件即可；而静态库的升级，需要重新编译依赖于该库的程序。</p></li><li><p>静态链接在编译阶段就进行符号解析，即所有函数和变量的引用都将在编译阶段解决；而动态链接在运行时进行符号解析，会增加函数和变量的加载时间。</p></li><li><p>在创建动态库时，需要使用 <code>-fPIC</code> 选项来生成在任意内存地址运行的代码。</p></li><li><p>静态库的连接顺序可能会影响最终的可执行文件，而动态库的依赖关系可以在运行时解决。</p></li></ul><h2 id="_38-单例模式" tabindex="-1"><a class="header-anchor" href="#_38-单例模式"><span>38. 单例模式</span></a></h2><p><strong>饿汉模式</strong> 实例在程序开始运行时就被创建，如直接在类中初始化静态成员。</p><p><strong>懒汉模式</strong> 实例在首次使用时才被创建，如静态局部变量。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">private</span><span class="token operator">:</span></span>
<span class="line">    <span class="token comment">// 将构造函数设置为 private</span></span>
<span class="line">    <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// 禁用拷贝构造函数和赋值操作符</span></span>
<span class="line">    <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token keyword">const</span> Singleton<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line">    Singleton<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Singleton<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">static</span> Singleton<span class="token operator">&amp;</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 利用局部静态变量的线程安全性，确保多线程环境下仅创建一个实例（C++11）</span></span>
<span class="line">        <span class="token keyword">static</span> Singleton instance<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> instance<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">private</span><span class="token operator">:</span></span>
<span class="line">    <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token keyword">const</span> Singleton<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line">    Singleton<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Singleton<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>mutex mutex_<span class="token punctuation">;</span> <span class="token comment">// 使用互斥锁显式保证线程安全</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">static</span> Singleton<span class="token operator">&amp;</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock</span><span class="token punctuation">(</span>mutex_<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">static</span> Singleton instance<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> instance<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">std<span class="token double-colon punctuation">::</span>mutex Singleton<span class="token double-colon punctuation">::</span>mutex_<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token comment">// 双重检测机制</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">private</span><span class="token operator">:</span></span>
<span class="line">    <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token keyword">const</span> Singleton<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line">    Singleton<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Singleton<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">static</span> Singleton <span class="token operator">*</span> instance_<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>mutex mutex_<span class="token punctuation">;</span> <span class="token comment">// 使用互斥锁显式保证线程安全</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">static</span> Singleton<span class="token operator">&amp;</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance_ <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock</span><span class="token punctuation">(</span>mutex_<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>instance_ <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                instance_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> instance_<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">Singleton<span class="token operator">*</span> Singleton<span class="token double-colon punctuation">::</span>instance_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></span>
<span class="line">std<span class="token double-colon punctuation">::</span>mutex Singleton<span class="token double-colon punctuation">::</span>mutex_<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_39-string-内部使用堆内存还是栈内存" tabindex="-1"><a class="header-anchor" href="#_39-string-内部使用堆内存还是栈内存"><span>39. string 内部使用堆内存还是栈内存</span></a></h2><p><code>std::string</code> 对象本身位于栈内，它所管理的字符串数据存储于堆内存中；但时，当字符串比较短时，部分实现可能会在 std::string 对象内部使用一个短字符串优化（SSO），此时字符串数据会位于栈内存中。</p><h2 id="_40-锁-lock-与原子变量-atomic" tabindex="-1"><a class="header-anchor" href="#_40-锁-lock-与原子变量-atomic"><span>40. 锁（lock）与原子变量（atomic）</span></a></h2><p>锁和原子变量都是 C++ 中的同步机制。</p><p><strong>锁的使用场景</strong></p><ul><li><p>保护长时间访问的临界区，如复杂的操作逻辑（复杂数据结构的操作）。</p></li><li><p>多个共享资源需要同步访问，一次性锁定多个资源，确保整体一致性。</p></li></ul><p><strong>锁的类型</strong></p><ul><li><p>互斥锁（Mutex）：资源独占</p></li><li><p>读写锁（Read-Write Lock）：读并行，写独占</p></li><li><p>自旋锁（Spin Lock）：线程在等待是会不断轮询锁状态而非挂起</p></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">std<span class="token double-colon punctuation">::</span>mutex mutex_<span class="token punctuation">;</span></span>
<span class="line">std<span class="token double-colon punctuation">::</span>map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> shared<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">insertIntoMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock</span><span class="token punctuation">(</span>mutex_<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    shared<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>原子变量的使用场景</strong></p><ul><li><p>操作可以在一个原子步骤内完成，如简单的整数增加或减少、标志位切换等。</p></li><li><p>性能优先，因为锁的开销和上下文切换成本过高。</p></li><li><p>用于实现非阻塞算法，原子变量不会导致线程挂起而等待锁释放。</p></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">increse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">++</span>counter<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">decrese</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">--</span>counter<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="死锁" tabindex="-1"><a class="header-anchor" href="#死锁"><span>死锁</span></a></h3><p>当两个或多个线程互相等待对方释放锁以继续执行时，发生死锁。</p><p><strong>死锁条件</strong></p><ul><li>互斥条件</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">std<span class="token double-colon punctuation">::</span>mutex mutex_<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock</span><span class="token punctuation">(</span>mutex_<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 临界区代码</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>占有且等待</li></ul><p>std::mutex mutex_a, mutex_b;</p><p>void thread_func() { std<iconify-icon class="vp-icon" icon="unique_lock&lt;std::mutex&gt; lock_a(mutex_a, std" sizing="height" height="1em"></iconify-icon>defer_lock); std<iconify-icon class="vp-icon" icon="unique_lock&lt;std::mutex&gt; lock_b(mutex_b, std" sizing="height" height="1em"></iconify-icon>defer_lock); // 脱离单独锁定合并为原子操作 std::lock(lock_a, lock_b); // 临界区代码 }</p><ul><li>不可剥夺</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">std<span class="token double-colon punctuation">::</span>mutex mutex_a<span class="token punctuation">,</span> mutex_b<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">thread_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        mutex_a<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>mutex_b<span class="token punctuation">.</span><span class="token function">try_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 临界区代码</span></span>
<span class="line"></span>
<span class="line">            mutex_b<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            mutex_a<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            mutex_a<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>环路等待</li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line">std<span class="token double-colon punctuation">::</span>mutex mutex_a<span class="token punctuation">,</span> mutex_b<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">thread_func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 遵循资源请求顺序</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span><span class="token function">lock</span><span class="token punctuation">(</span>mutex_a<span class="token punctuation">,</span> mutex_b<span class="token punctuation">)</span><span class="token punctuation">;</span> </span>
<span class="line">    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock_a</span><span class="token punctuation">(</span>mutex_a<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>adopt_lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock_b</span><span class="token punctuation">(</span>mutex_b<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>adopt_lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">thread_func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 遵循资源请求顺序</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span><span class="token function">lock</span><span class="token punctuation">(</span>mutex_a<span class="token punctuation">,</span> mutex_b<span class="token punctuation">)</span><span class="token punctuation">;</span> </span>
<span class="line">    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock_a</span><span class="token punctuation">(</span>mutex_a<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>adopt_lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock_b</span><span class="token punctuation">(</span>mutex_b<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>adopt_lock<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>解决死锁问题只需破坏以上四个条件之一即可。</p><ul><li><p>避免互斥条件：减少资源的独占性，使用非阻塞同步机制。</p></li><li><p>破坏占有且等待：采用资源预分配策略，一次性请求所需的所有资源。</p></li><li><p>破话不可剥夺：如果进程的不过需要资源，应该释放它所持有的资源或者使用优先级来剥夺资源</p></li><li><p>破话环路等待：对系统中的资源进行排序，每个线程按序请求资源，避免形成环路。</p></li></ul><h2 id="_41-继承-is-a-vs-组合-has-a" tabindex="-1"><a class="header-anchor" href="#_41-继承-is-a-vs-组合-has-a"><span>41. 继承（Is-a） vs. 组合(Has-a)</span></a></h2><p><strong>继承使用场景</strong></p><ul><li><p>两个类之间的关系是 Is-a 时，如 Dog 是 Animal。</p></li><li><p>派生类要对基类的行为进行拓展或修改并能够利用多态性质时。</p></li><li><p>基类提供了通用的功能，而派生类则基于这些功能进行特化。</p></li></ul><p><strong>优点</strong>：代码复用，多态性</p><p><strong>缺点</strong>：强耦合</p><p><strong>里氏替换原则</strong> 确保派生类能够代替基类使用。</p><p><strong>组合使用场景</strong></p><ul><li><p>两个类之间的关系是 Has-a 时，如 Car 有多个 Engine。</p></li><li><p>复用其他类的功能，而非继承它们。</p></li><li><p>系统的不同部分以不同的方式进行组合，组合便于维护和拓展。</p></li></ul><p><strong>优点</strong>：灵活性高，低耦合</p><p><strong>缺点</strong>：设计复杂性增加，性能开销增加</p><p><strong>指责单一原则</strong> 每个组件应该尽量保持单一职责，避免单一组件承担过多功能。</p><h2 id="_42-返回值优化-return-value-optimization-rvo" tabindex="-1"><a class="header-anchor" href="#_42-返回值优化-return-value-optimization-rvo"><span>42. 返回值优化（Return Value Optimization，RVO）</span></a></h2><p>返回值优化是 C++ 编译器的一种优化技术，它主要针对返回值临时对象的创建和析构进行优化。编译器可以在某些情况下省略临时对象的构建和析构，直接在返回位置构建对象，从而提高程序的性能。</p><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">public</span><span class="token operator">:</span></span>
<span class="line">    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">~</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// RVO</span></span>
<span class="line">MyClass <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// NRVO</span></span>
<span class="line">MyClass <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    MyClass obj<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    <span class="token keyword">return</span> obj<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_43-野指针" tabindex="-1"><a class="header-anchor" href="#_43-野指针"><span>43. 野指针</span></a></h2><p>野指针指向的位置不可知，从而导致在进行内存访问时，产生非法访问的错误。</p><p><strong>避免</strong></p><ul><li><p>将指针初始化如 nullptr</p></li><li><p>释放指针指向内容后，将其置 nullptr</p></li><li><p>使用智能指针进行资源管理</p></li></ul><h2 id="_44-内联函数-vs-宏函数" tabindex="-1"><a class="header-anchor" href="#_44-内联函数-vs-宏函数"><span>44. 内联函数 vs. 宏函数</span></a></h2><ul><li><p>宏函数和内联函数分别在程序的预处理阶段和编译阶段展开；</p></li><li><p>宏函数只是简单的字符替换，不具类型安全性；</p></li><li><p>内联函数在编译时将对类型的合法性进行检查。</p></li></ul><h2 id="_45-c-传值方式" tabindex="-1"><a class="header-anchor" href="#_45-c-传值方式"><span>45. C++ 传值方式</span></a></h2><ul><li><p>值传递</p></li><li><p>指针传递</p></li><li><p>引用传递</p></li></ul><h2 id="_46-内存泄露场景" tabindex="-1"><a class="header-anchor" href="#_46-内存泄露场景"><span>46. 内存泄露场景</span></a></h2><ul><li><p>使用 new 和 malloc 申请内存资源时，未使用 delete 和 free 进行释放；</p></li><li><p>在继承关系中，如果父类的析构函数不为虚函数时，通过父类指针或引用指向子类对象，将导致仅有父类部分被正确析构。</p></li></ul><h2 id="_47-重载-vs-重写" tabindex="-1"><a class="header-anchor" href="#_47-重载-vs-重写"><span>47. 重载 vs. 重写</span></a></h2><ul><li><p>重写指的是在派生类中重新定义基类中的函数，该函数除函数体外与基类函数保持一致；</p></li><li><p>重载允许参数列表具有不一致性！</p></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span></span>
<span class="line"><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>如何在 C 语言中实现重载？</strong></p><ul><li><p>使用函数指针来实现，尽管如此重载的函数仍不能使用相同的名称；</p></li><li><p>重载函数使用可变参数</p></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">func_int</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">func_double</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>ptr<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">c_func</span><span class="token punctuation">(</span>ptr p<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>param<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">p</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_48-c-类对象的初始化顺序" tabindex="-1"><a class="header-anchor" href="#_48-c-类对象的初始化顺序"><span>48. C++ 类对象的初始化顺序</span></a></h2><ul><li><p>基类的构造函数</p></li><li><p>成员类的构造函数</p></li><li><p>派生类的构造函数</p></li></ul><h2 id="_49-虚析构-vs-虚构造" tabindex="-1"><a class="header-anchor" href="#_49-虚析构-vs-虚构造"><span>49. 虚析构 Vs. 虚构造</span></a></h2><ul><li><p>使用派生类类型指针指向派生类的实例，不管基类的析构函数是否为虚函数，都能够正常析构；</p></li><li><p>用基类类型指针指向派生类实例，如果基类的析构函数不是虚函数，则将只会析构基类实例，而不是析构派生类对象实例。</p></li></ul><p><strong>不能使用虚构造函数</strong></p><ul><li>从存储空间角度来讲，虚函数对应的 vtable 存储于对象的内存空间中，而在调用构造函数时，对象的存储空间还尚未分配！</li></ul><h2 id="_50-模板类的实现" tabindex="-1"><a class="header-anchor" href="#_50-模板类的实现"><span>50. 模板类的实现</span></a></h2><ul><li><p>模板实例化</p><ul><li><p>显式实例化</p></li><li><p>隐式实例化</p></li></ul></li><li><p>模板具体化：当使用模板实例化生成的类或函数不能够满足需求是，模板具体化允许修改原模板的定义。</p></li></ul><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp"><pre><code class="language-cpp"><span class="line"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">struct</span> <span class="token class-name">TemplateStruct</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">TemplateStruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 模板显式实例化</span></span>
<span class="line"><span class="token keyword">template</span> <span class="token keyword">struct</span> <span class="token class-name">TemplateStruct</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 模板具体化</span></span>
<span class="line"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token keyword">struct</span> <span class="token class-name">TemplateStruct</span><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">TemplateStruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;-- 8 --&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 模板隐式实例化</span></span>
<span class="line">TemplateStruct<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span> temp<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_50-类的引用数据成员的初始化" tabindex="-1"><a class="header-anchor" href="#_50-类的引用数据成员的初始化"><span>50. 类的引用数据成员的初始化</span></a></h2><ul><li><p>不能使用默认构造函数进行初始化</p></li><li><p>构造函数的形参也必须时引用类型</p></li><li><p>不能再构造函数体内进行初始化，仅能在初始化列表中进行初始化</p></li></ul><h2 id="_51-不能虚化的函数" tabindex="-1"><a class="header-anchor" href="#_51-不能虚化的函数"><span>51. 不能虚化的函数</span></a></h2><ul><li><p>普通函数（非成员函数）：只能够被重载，不能够被覆盖，因为普通函数本身不属于任何类对象，故也不会存在于类的继承体系中；</p></li><li><p>友元函数：与普通函数相比，友元函数能够访问对象的内部状态，但 C++ 并不支持友元函数的继承（友元函数本身也不属于任何类对象）；</p></li><li><p>构造函数</p></li><li><p>静态成员函数：属于类而非某个类对象，不存在隐式 this 指针，故无法进行对象的判别。</p></li><li><p>内联成员函数：内联函数在编译期间展开，而虚函数在运行时进行绑定，二者在行为上矛盾。</p></li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/mgkl92/mgkl92.github.io/edit/main/docs/cpp/cpp_interview.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]--><!--]-->Edit this page<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新: </span><time class="meta-item-info" datetime="2025-07-10T14:24:09.000Z" data-allow-mismatch>2025/7/10 14:24</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: zst_lff@126.com">mgkl92</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CkPgLnmy.js" defer></script>
  </body>
</html>
